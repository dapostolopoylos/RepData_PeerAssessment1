---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---



 These are the steps followed for the completion of the first Peer Assesment of the "Reproducible Research" Coursera course. 
 
 

## Loading and preprocessing the data

The data have already been downloaded in the working directory and they are loaded in R using the **read.csv()**. They are also loaded the libraries needed throughout the assesment.

```{r loadData, echo=TRUE, message=FALSE, results='hide'}
library(dplyr)
library(sqldf)

Sys.setlocale("LC_TIME", "English")

file <- "./activity.csv"

if (!file.exists(file)){
     unzip("activity.zip", unzip = "internal") 
}

data <- read.csv(file, header=TRUE, sep=",", stringsAsFactors = FALSE)
```

## What is mean total number of steps taken per day?

In order to answer the first question i am transforming my data to create the plot of ***"Total Steps Per Date"***.

```{r stepsPerDay, echo=TRUE, message=FALSE, results='hide',cache=TRUE}
q1 <- select(data[!is.na(data$steps),],steps,date) %>% 
          group_by(date) %>% 
          summarize(TotalSteps=sum(steps))

Sys.setlocale("LC_TIME", "English")

plot(as.Date(q1$date,format="%Y-%m-%d"),q1$TotalSteps,type="h",xlab="Date",ylab="Total Steps",main="Total Steps Per Date", col="blue")
```

The **mean** total number of steps taken per day equals to:

```{r meanTotal, echo=TRUE, cache=TRUE} 
mean(q1$TotalSteps)
```



The **median** total number of steps taken per day equals to:

```{r medianTotal, echo=TRUE, cache=TRUE} 
median(q1$TotalSteps)
```

## What is the average daily activity pattern?

The average activity pattern is depicted in the following plot:

``` {r avgActivityPattern, echo=TRUE, cache=TRUE}

q2 <- select(data[!is.na(data$steps),],steps,interval) %>% 
    group_by(interval)  %>% 
    summarize(AverageSteps=mean(steps))

plot(q2,type="l",xlab="Interval",ylab="Average Steps",main="Average Steps per Interval",col="blue")
```


The 5-minute interval, on average across all the days in the dataset which contains the maximum number of steps is the following:

```{r intervalMaxsteps, echo=TRUE, cache=TRUE}
q2[order(-q2$Average.Steps),][1,1]
```



## Imputing missing values

The number of rows with NA values in the dataset is:

```{r NAs, echo=TRUE,cache=TRUE}
sum(is.na(data))
```

I create a new dataset for the purposes of this section of this Assesement with all the NA values of the steps variable replaced with the average value of steps per interval which i already have calculated from question 2.

```{r fillNA, echo=TRUE, cache=TRUE, message=FALSE,}
q3<- sqldf("select 
              case 
                when data.steps is null then AverageSteps 
                else steps 
              end as steps,
              data.date,
              data.interval
            from 
              data 
              inner join q2 
              on data.interval=q2.interval")

q3 <- select(q3,steps,date) %>% 
             group_by(date) %>% 
             summarize(TotalSteps=sum(steps))

plot(as.Date(q3$date,format="%Y-%m-%d"),q3$TotalSteps,type="h",xlab="Date",ylab="Total Steps",main="Total Steps Per Date",col="blue")
```

The **mean** total number of steps taken per day equals to:

```{r meanTotalQ3, echo=TRUE, cache=TRUE} 
mean(q3$TotalSteps)
```



The **median** total number of steps taken per day equals to:

```{r medianTotalQ3, echo=TRUE, cache=TRUE} 
median(q3$TotalSteps)
```


As we can see by filling the NA values there is a similar pattern to our plot with the one from Question 1 but the values have slightly decreased.

## Are there differences in activity patterns between weekdays and weekends?
